<!-- √î t√¨m ki·∫øm -->
<form class="d-flex mb-3" th:action="@{/admin/orders}" method="get">
    <input type="text" name="keyword" class="form-control me-2 w-25"
           placeholder="T√¨m h√≥a ƒë∆°n theo kh√°ch h√†ng..." th:value="${keyword}">
    <button type="submit" class="btn btn-primary me-2">
        <i class="bi bi-search"></i> T√¨m
    </button>
</form>

<!-- B·∫£ng danh s√°ch h√≥a ƒë∆°n -->
<div class="table-responsive shadow-sm rounded-3">
    <table class="table table-hover table-striped align-middle text-center mb-0">
        <thead class="table-secondary">
        <tr>
            <th scope="col"><i class="bi bi-hash"></i></th>
            <th scope="col"><i class="bi bi-person"></i> Kh√°ch h√†ng</th>
            <th scope="col"><i class="bi bi-calendar"></i> Ng√†y l·∫≠p</th>
            <th scope="col"><i class="bi bi-cash-stack"></i> T·ªïng ti·ªÅn</th>
            <th scope="col"><i class="bi bi-info-circle"></i> Tr·∫°ng th√°i</th>
            <th scope="col"><i class="bi bi-gear"></i> Thao t√°c</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="o, st : ${orders}">
            <td th:text="${st.index + 1 + currentPage * 10}"></td>
            <td th:text="${o.user.name}"></td>
            <td th:text="${#dates.format(o.date, 'dd/MM/yyyy')}"></td>
            <td th:text="${#numbers.formatDecimal(o.total, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>
            <td>
                <span th:text="${o.status}"
                      th:classappend="${o.status == 'ƒê√£ thanh to√°n'} ? 'text-success fw-bold' :
                      (o.status == 'ƒêang giao h√†ng' ? 'text-primary fw-bold' :
                      (o.status == 'ƒê√£ giao h√†ng' ? 'text-info fw-bold' :
                      (o.status == 'H·ªßy' ? 'text-danger fw-bold' : 'text-secondary fw-bold')))">
                </span>
            </td>
            <td class="d-flex justify-content-center gap-1">

                <!-- üîç N√∫t xem chi ti·∫øt -->
                <button type="button" class="btn btn-sm btn-primary text-white"
                        th:attr="data-bs-toggle='modal', data-bs-target='#viewModal__' + ${o.id}">
                    <i class="bi bi-eye"></i> Xem
                </button>

                <!-- ‚úèÔ∏è N√∫t c·∫≠p nh·∫≠t tr·∫°ng th√°i -->
                <a th:href="@{'/admin/orders/edit/' + ${o.id}}"
                   class="btn btn-sm btn-warning text-white">
                    <i class="bi bi-pencil-square"></i> S·ª≠a
                </a>

                <!-- üßæ Modal xem chi ti·∫øt -->
                <div class="modal fade" th:id="'viewModal__' + ${o.id}" tabindex="-1"
                     aria-labelledby="viewModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content border-0 shadow-lg">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">
                                    <i class="bi bi-receipt"></i> Chi ti·∫øt h√≥a ƒë∆°n
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body text-start">
                                <p><strong>Kh√°ch h√†ng:</strong> <span th:text="${o.user.name}"></span></p>
                                <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> <span th:text="${o.user.phonenumber}"></span></p>
                                <p><strong>ƒê·ªãa ch·ªâ:</strong> <span th:text="${o.address.address}"></span></p>
                                <p><strong>Ng√†y l·∫≠p:</strong> <span th:text="${#dates.format(o.date, 'dd/MM/yyyy')}"></span></p>
                                <p><strong>Tr·∫°ng th√°i:</strong> <span th:text="${o.status}"></span></p>

                                <hr>

                                <!-- B·∫£ng chi ti·∫øt s·∫£n ph·∫©m -->
                                <table class="table table-bordered mt-3">
                                    <thead class="table-secondary">
                                    <tr>
                                        <th>S·∫£n ph·∫©m</th>
                                        <th>S·ªë l∆∞·ª£ng</th>
                                        <th>ƒê∆°n gi√°</th>
                                        <th>Th√†nh ti·ªÅn</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="ct : ${o.orderDetails}">
                                        <td th:text="${ct.product.name}"></td>
                                        <td th:text="${ct.quantity}"></td>
                                        <td th:text="${#numbers.formatDecimal(ct.price, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>
                                        <td th:text="${#numbers.formatDecimal(ct.quantity * ct.price, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>
                                    </tr>
                                    </tbody>
                                </table>

                                <h5 class="text-end">T·ªïng c·ªông:
                                    <span th:text="${#numbers.formatDecimal(o.total, 0, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></span>
                                </h5>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                            </div>
                        </div>
                    </div>
                </div>

            </td>
        </tr>

        <tr th:if="${#lists.isEmpty(orders)}">
            <td colspan="6" class="text-muted py-3">
                <i class="bi bi-exclamation-circle"></i> Kh√¥ng t√¨m th·∫•y h√≥a ƒë∆°n n√†o.
            </td>
        </tr>
        </tbody>
    </table>
</div>
