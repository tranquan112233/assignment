<div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-success text-white d-flex align-items-center">
        <i class="bi bi-file-earmark-text me-2 fs-5"></i>
        <h5 class="mb-0 flex-grow-1">Th√™m / C·∫≠p nh·∫≠t Phi·∫øu Nh·∫≠p</h5>
    </div>

    <div class="card-body px-4 py-3">
        <form th:fragment="_form" th:action="@{/admin/goodsreceipt/save}"
              method="post" th:object="${goodsReceipt}">
            <!-- ID t·ª± sinh -->
            <input type="hidden" th:field="*{id}" />

            <!-- üßæ Th√¥ng tin phi·∫øu nh·∫≠p -->
            <div class="row mb-3">
                <!-- ‚úÖ Nh√† cung c·∫•p -->
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Nh√† cung c·∫•p</label>
                    <select class="form-select" name="supplier">
                        <option value="" disabled selected>-- Ch·ªçn nh√† cung c·∫•p --</option>
                        <option th:each="s : ${suppliers}"
                                th:value="${s.id}"
                                th:text="${s.name}"
                                th:selected="${goodsReceipt.supplier != null and s.id == goodsReceipt.supplier.id}">
                        </option>
                    </select>
                </div>

                <!-- ‚úÖ Ng√†y nh·∫≠p -->
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Ng√†y nh·∫≠p</label>
                    <input type="date" class="form-control"
                           th:field="*{date}" required>
                </div>
            </div>

            <!-- ‚úÖ T·ªïng ti·ªÅn -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <label class="form-label fw-semibold">T·ªïng ti·ªÅn (VNƒê)</label>
                    <input type="number" step="0.01" class="form-control"
                           th:field="*{totalAmount}" placeholder="Nh·∫≠p t·ªïng ti·ªÅn">
                </div>
                <div class="col-md-6 d-flex align-items-end">
                    <span class="text-muted fst-italic">T·ªïng ti·ªÅn c√≥ th·ªÉ t·ª± ƒë·ªông t√≠nh t·ª´ chi ti·∫øt phi·∫øu nh·∫≠p</span>
                </div>
            </div>

            <!-- üß© Chi ti·∫øt phi·∫øu nh·∫≠p -->
            <hr class="my-4">
            <h5 class="mb-3 text-primary">
                <i class="bi bi-list-check me-2"></i> Chi ti·∫øt phi·∫øu nh·∫≠p
            </h5>

            <div id="detailContainer">
                <div class="row mb-3 detail-row">
                    <div class="col-md-4">
                        <label class="form-label fw-semibold">S·∫£n ph·∫©m</label>
                        <select class="form-select" name="sanPhamIds" required>
                            <option value="">-- Ch·ªçn s·∫£n ph·∫©m --</option>
                            <option th:each="sp : ${products}"
                                    th:value="${sp.id}"
                                    th:text="${sp.name}"></option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-semibold">S·ªë l∆∞·ª£ng</label>
                        <input type="number" class="form-control" name="soLuongs" min="1" required>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label fw-semibold">ƒê∆°n gi√° (VNƒê)</label>
                        <input type="number" step="0.01" class="form-control" name="donGias" required>
                    </div>

                    <div class="col-md-2 d-flex align-items-end">
                        <button type="button" class="btn btn-outline-danger remove-detail w-100">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ‚úÖ N√∫t th√™m d√≤ng -->
            <div class="mb-4">
                <button type="button" id="addDetailRow" class="btn btn-outline-primary">
                    <i class="bi bi-plus-circle me-1"></i> Th√™m d√≤ng chi ti·∫øt
                </button>
            </div>

            <!-- ‚úÖ N√∫t l∆∞u -->
            <div class="text-end">
                <button type="submit" class="btn btn-success">
                    <i class="bi bi-save me-1"></i> L∆∞u phi·∫øu nh·∫≠p
                </button>
            </div>
        </form>
    </div>
</div>

<!-- üß† Script ƒë·ªÉ th√™m/x√≥a d√≤ng chi ti·∫øt -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const addBtn = document.getElementById('addDetailRow');
        const container = document.getElementById('detailContainer');

        addBtn.addEventListener('click', function () {
            const newRow = container.querySelector('.detail-row').cloneNode(true);
            newRow.querySelectorAll('input, select').forEach(el => el.value = '');
            container.appendChild(newRow);
        });

        container.addEventListener('click', function (e) {
            if (e.target.closest('.remove-detail')) {
                if (container.querySelectorAll('.detail-row').length > 1) {
                    e.target.closest('.detail-row').remove();
                } else {
                    alert('Ph·∫£i c√≥ √≠t nh·∫•t m·ªôt d√≤ng chi ti·∫øt!');
                }
            }
        });
    });
</script>
